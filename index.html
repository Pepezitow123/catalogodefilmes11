<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo de Filmes - Fase 2: Cadastro Manual Consumo de API</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<h1>Catálogo de Filmes</h1>

<form id="cadastro-filme">
  <h2>Adicionar Novo Filme (Busca por API)</h2>
  <div>
    <label for="titulo">Título do Filme:</label>
    <input type="text" id="titulo" required>
  </div>

  <button type="submit">Buscar e Adicionar Filme</button>
</form>

<hr>

<h2>Minha Lista De Filmes</h2>
<div id="lista-filmes">
  <p>Nenhum filme cadastrado ainda.</p>
</div>

<script>
// CHAVE DA API OMDb (substitua pela sua chave real)
const API_KEY = 'dc96c932';

// Armazenamento de dados
const catalogo = [];

// Captura de elementos do DOM
const form = document.getElementById('cadastro-filme');
const tituloInput = document.getElementById('titulo');
const listaFilmesContainer = document.getElementById('lista-filmes');

// Função de remoção
function removerFilme(indice, elementoDOM) {
  catalogo.splice(indice, 1);
  elementoDOM.remove();

  if (catalogo.length === 0) {
    listaFilmesContainer.innerHTML = '<p>Nenhum filme cadastrado ainda.</p>';
  }
}

// Função de renderização (sem sinopse)
function renderizarFilme(filme, indice) {
  if (catalogo.length === 1) {
    listaFilmesContainer.innerHTML = '';
  }

  const filmeDiv = document.createElement('div');
  filmeDiv.classList.add('filme-item');

  // Pôster
  const imagemPoster = document.createElement('img');
  imagemPoster.src = filme.poster && filme.poster !== 'N/A'
    ? filme.poster
    : 'https://via.placeholder.com/100x150?text=Poster+Nao+Disponivel';
  imagemPoster.alt = `Pôster do filme ${filme.titulo}`;
  imagemPoster.classList.add('filme-poster');

  // Informações
  const infoDiv = document.createElement('div');
  infoDiv.classList.add('filme-info');

  const tituloH3 = document.createElement('h3');
  tituloH3.textContent = filme.titulo;

  const removerBotao = document.createElement('button');
  removerBotao.textContent = 'Remover';
  removerBotao.classList.add('btn-remover');

  // Evento de remoção
  removerBotao.addEventListener('click', () => {
    const indiceAtual = catalogo.findIndex(f => f.titulo === filme.titulo);
    if (indiceAtual > -1) {
      removerFilme(indiceAtual, filmeDiv);
    }
  });

  // Montagem do DOM
  infoDiv.appendChild(tituloH3);
  infoDiv.appendChild(removerBotao);

  filmeDiv.appendChild(imagemPoster);
  filmeDiv.appendChild(infoDiv);

  listaFilmesContainer.appendChild(filmeDiv);
}

// Função principal de adição (assíncrona para a API)
async function adicionarFilme(evento) {
  evento.preventDefault();

  const titulo = tituloInput.value.trim();
  if (!titulo) return;

  const tituloFormatado = encodeURIComponent(titulo);
  const url = `https://www.omdbapi.com/?apikey=${API_KEY}&t=${tituloFormatado}`;

  try {
    const resposta = await fetch(url);
    const dadosDoFilme = await resposta.json();

    if (dadosDoFilme.Response === "True") {
      const novoFilme = {
        titulo: dadosDoFilme.Title,
        poster: dadosDoFilme.Poster
      };

      catalogo.push(novoFilme);
      renderizarFilme(novoFilme, catalogo.length - 1);
    } else {
      alert(`Filme não encontrado na OMDb: "${titulo}".`);
    }
  } catch (error) {
    alert('Ocorreu um erro ao tentar buscar o filme na API. Verifique sua chave.');
    console.error('Erro de Fetch:', error);
  }

  form.reset();
}

// Escutando o evento do formulário
form.addEventListener('submit', adicionarFilme);
</script>
</body>
</html>
